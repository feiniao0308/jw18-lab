FROM ansibleplaybookbundle/apb-base

LABEL "com.redhat.apb.spec"=\
"dmVyc2lvbjogMS4wCm5hbWU6IGNsb3VkbmF0aXZlLWlzdGlvLXdvcmtzaG9wLWFwYgpkZXNjcmlw\
dGlvbjogQVBCIHRvIGRlcGxveSByZXF1aXJlZCBpbmZyYSBjb21wb25lbnRzIGZvciB0aGUgQ2xv\
dWQtTmF0aXZlIEFwcHMgd2l0aCBJc3RpbyBXb3Jrc2hvcCBvbiBhbiBPcGVuU2hpZnQgY2x1c3Rl\
cgpiaW5kYWJsZTogRmFsc2UKYXN5bmM6IG9wdGlvbmFsCnRhZ3M6Ci0gd29ya3Nob3AKbWV0YWRh\
dGE6CiAgZGVwZW5kZW5jaWVzOiBbXQogIGRpc3BsYXlOYW1lOiAiQ2xvdWQtTmF0aXZlIHdpdGgg\
SXN0aW8gV29ya3Nob3AgSW5zdGFsbGVyIgogIGxvbmdEZXNjcmlwdGlvbjogIkluc3RhbGxzIHRo\
ZSBsYWIgaW5zdHJ1Y3Rpb25zIGFuZCByZXF1aXJlZCBjb21wb25lbnRzIChHaXQgc2VydmVyLCBO\
ZXh1cywgRWNsaXBzZSBDaGUsIGV0YykgZm9yIHJ1bm5pbmcgdGhlIENsb3VkLU5hdGl2ZSBBcHBz\
IHdpdGggSXN0aW8gV29ya3Nob3AgaHR0cHM6Ly9naXRodWIuY29tL29wZW5zaGlmdC1sYWJzL3Jo\
c3VtbWl0MTgtY2xvdWRuYXRpdmUtZ3VpZGVzIgogIGNvbnNvbGUub3BlbnNoaWZ0LmlvL2ljb25D\
bGFzczogInBmaWNvbiBwZmljb24tcHJvY2Vzcy1hdXRvbWF0aW9uIgogIHByb3ZpZGVyRGlzcGxh\
eU5hbWU6ICJSZWQgSGF0LCBJbmMuIgpwbGFuczoKICAtIG5hbWU6IGRlZmF1bHQKICAgIGRlc2Ny\
aXB0aW9uOiBEZXBsb3lzIENsb3VkLU5hdGl2ZSB3aXRoIElzdGlvIFdvcmtzaG9wIEluZnJhc3Ry\
dWN0dXJlCiAgICBmcmVlOiBUcnVlCiAgICBtZXRhZGF0YToKICAgICAgZGlzcGxheU5hbWU6IERl\
ZmF1bHQKICAgIHBhcmFtZXRlcnM6CiAgICAtIG5hbWU6IG9wZW5zaGlmdF91c2VyCiAgICAgIHRp\
dGxlOiBVc2VybmFtZQogICAgICBkZXNjcmlwdGlvbjogVXNlciBpcyByZXF1aXJlZCBmb3IgY3Jl\
YXRpbmcgcHJvamVjdCBhZG1pbiByZXNvdXJjZXMKICAgICAgdHlwZTogc3RyaW5nCiAgICAgIHJl\
cXVpcmVkOiB0cnVlCiAgICAgIGRpc3BsYXlfZ3JvdXA6IE9wZW5TaGlmdCBBZG1pbiBVc2VyCiAg\
ICAtIG5hbWU6IG9wZW5zaGlmdF9wYXNzd29yZAogICAgICB0aXRsZTogUGFzc3dvcmQKICAgICAg\
ZGVzY3JpcHRpb246IFBhc3N3b3JkIGlzIHJlcXVpcmVkIGZvciBjcmVhdGluZyBwcm9qZWN0IGFk\
bWluIHJlc291cmNlcwogICAgICB0eXBlOiBzdHJpbmcKICAgICAgcmVxdWlyZWQ6IHRydWUKICAg\
ICAgZGlzcGxheV90eXBlOiBwYXNzd29yZAogICAgICBkaXNwbGF5X2dyb3VwOiBPcGVuU2hpZnQg\
QWRtaW4gVXNlcgogICAgLSBuYW1lOiBvcGVuc2hpZnRfbWFzdGVyX3VybAogICAgICB0aXRsZTog\
T3BlblNoaWZ0IE1hc3RlciBVUkwKICAgICAgZGVzY3JpcHRpb246IFRoZSBhZGRyZXNzIHRvIE9w\
ZW5TaGlmdCBtYXN0ZXIgVVJMIHRvIGJlIGRpc3BsYXllZCBpbiB0aGUgbGFiIGd1aWRlIHRvIHBh\
cnRpY2lwYW50cwogICAgICB0eXBlOiBzdHJpbmcKICAgICAgcmVxdWlyZWQ6IHRydWUKICAgICAg\
ZGlzcGxheV90eXBlOiBzdHJpbmcKICAgICAgZGlzcGxheV9ncm91cDogV29ya3Nob3AKICAgIC0g\
bmFtZTogdXNlcl9jb3VudAogICAgICB0aXRsZTogTnVtYmVyIG9mIHBhcnRpY2lwYW50cwogICAg\
ICBkZXNjcmlwdGlvbjogTnVtYmVyIG9mIHBhcnRpY2lwYW50cyBmb3IgdGhlIHdvcmtzaG9wLiBU\
aGVyZSB3aWxsIGJlIHByb3Zpc2lvbmVkIGluZnJhc3RydWN0dXJlL3Byb2plY3QgZm9yIGVhY2gg\
cGFydGljaXBhbnQKICAgICAgdHlwZTogbnVtYmVyCiAgICAgIHJlcXVpcmVkOiB0cnVlCiAgICAg\
IGRpc3BsYXlfZ3JvdXA6IFdvcmtzaG9wCiAgICAtIG5hbWU6IHVzZXJfcGFzc3dvcmQKICAgICAg\
dGl0bGU6IFVzZXIgUGFzc3dvcmQKICAgICAgZGVzY3JpcHRpb246IFRoZSBwYXNzd29yZCBmb3Ig\
cGFydGljaXBhbnRzIG9uIEdvZ3MgR2l0IFNlcnZlciwgRWNsaXBzZSBDaGUsIGV0YywgcHJlZmVy\
cmFibHkgdXNlIHRoZSBzYW1lIHBhc3N3b3JkIGFzIHRoZSBPcGVuU2hpZnQgdXNlcgogICAgICB0\
eXBlOiBzdHJpbmcKICAgICAgcmVxdWlyZWQ6IHRydWUKICAgICAgZGlzcGxheV90eXBlOiBzdHJp\
bmcKICAgICAgdmFsdWU6ICJvcGVuc2hpZnQiCiAgICAgIGRpc3BsYXlfZ3JvdXA6IFdvcmtzaG9w\
CiAgICAtIG5hbWU6IGluZnJhc3Zjc19hZG1fdXNlcgogICAgICB0aXRsZTogSW5mcmEgU2Vydmlj\
ZXMgQWRtaW4gVXNlcgogICAgICBkZXNjcmlwdGlvbjogQWRtaW4gdXNlciBmb3IgaW5mcmFzdHJ1\
Y3R1cmUgc2VydmljZXMgKEdvZ3MsIENoZSwgLi4uKS4gRG9uJ3QgY2hvb3NlICJhZG1pbiIhCiAg\
ICAgIHR5cGU6IHN0cmluZwogICAgICBkZWZhdWx0OiAiYWRtaW51c2VyIgogICAgICByZXF1aXJl\
ZDogdHJ1ZQogICAgICBkaXNwbGF5X3R5cGU6IHRleHQKICAgICAgZGlzcGxheV9ncm91cDogV29y\
a3Nob3AgSW5mcmEgU2VydmljZXMKICAgIC0gbmFtZTogaW5mcmFzdmNzX2FkbV9wd2QKICAgICAg\
dGl0bGU6IEluZnJhIFNlcnZpY2VzIEFkbWluIFBhc3N3b3JkCiAgICAgIGRlc2NyaXB0aW9uOiBB\
ZG1pbiBwYXNzd29yZCBmb3IgaW5mcmFzdHJ1Y3R1cmUgc2VydmljZXMgKEdvZ3MsIENoZSwgLi4u\
KQogICAgICB0eXBlOiBzdHJpbmcKICAgICAgZGVmYXVsdDogImFkbWlucHdkIgogICAgICByZXF1\
aXJlZDogdHJ1ZQogICAgICBkaXNwbGF5X3R5cGU6IHRleHQKICAgICAgZGlzcGxheV9ncm91cDog\
V29ya3Nob3AgSW5mcmEgU2VydmljZXM="

COPY playbooks /opt/apb/actions
COPY roles /opt/apb/actions
ADD requirements.yml /opt/apb/actions/requirements.yml
RUN ansible-galaxy install -r /opt/apb/actions/requirements.yml -f
RUN chmod -R g=u /opt/{ansible,apb}
USER apb
